var won,gameInit,pipeGapSize=80,config=[["denealSplash","smith","denealEnd",5,"denealWin.gif",.25,"You got Deneal on the way to Warwick!"],["derhamSplash","derham","derhamEnd",22,"derhamWin.gif",.3,"You got Derham his OBE!"],["deanSplash","dean","deanEnd",2147483647,"cheat.png",.25,""]],gameRunning=!1;function gameStart(e){config=config[parseInt(e)],document.getElementById("game").style.display="block",document.getElementById("container").style.display="none",document.getElementById("winContainer").style.display="none",won=!1,gameInit=!0,game.init()}console.log("%c Welcome to FlappySmith! ","color: #f77e9d; font-size: 50px;"),console.log("%c FlappySmith was developed anonymously as part of the 2nd Edition of Pink 2018 during early June - with booklet release taking place in the first few days of July.","font-style: italic;"),console.log("%c Original game gravity mechanics from library - styling, content, music and gameplay by this developer Â©2018",""),console.log("%c Trees in loving memory of the Yard tree :(","color: #005500;"),window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};var soundJump=new Audio("wing.mp3"),soundScore=new Audio("point.mp3"),soundHit=new Audio("hit.mp3"),soundDie=new Audio("amen.mp3"),soundSwoosh=new Audio("deus.mp3"),channel_max=10;for(audiochannels=new Array,a=0;a<channel_max;a++)audiochannels[a]=new Array,audiochannels[a].channel=new Audio,audiochannels[a].finished=-1;function play_sound(e,t){for(void 0===t&&(t=!1),a=0;a<audiochannels.length;a++)if(t&&audiochannels[a].channel.pause(),thistime=new Date,audiochannels[a].finished<thistime.getTime()){audiochannels[a].finished=thistime.getTime()+1e3*e.duration,audiochannels[a].channel.src=e.src,audiochannels[a].channel.load(),audiochannels[a].channel.play();break}}function getCookie(e){for(var t=e+"=",a=document.cookie.split(";"),i=0;i<a.length;i++){var n=a[i].trim();if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""}function setCookie(e,t,a){var i=new Date;i.setTime(i.getTime()+24*a*60*60*1e3);var n="expires="+i.toGMTString();document.cookie=e+"="+t+"; "+n}var game={WIDTH:320,HEIGHT:480,scale:1,offset:{top:0,left:0},entities:[],currentWidth:null,currentHeight:null,canvas:null,ctx:null,score:{taps:0,coins:0},distance:0,digits:[],fonts:[],RATIO:null,bg_grad:"day",game:null,canvas:null,ctx:null,ua:null,android:null,ios:null,gradients:{},init:function(){var e;game.RATIO=game.WIDTH/game.HEIGHT,game.currentWidth=game.WIDTH,game.currentHeight=game.HEIGHT,game.canvas=document.getElementsByTagName("canvas")[0],game.canvas.width=game.WIDTH,game.canvas.height=game.HEIGHT,game.ctx=game.canvas.getContext("2d"),game.ua=navigator.userAgent.toLowerCase(),game.android=game.ua.indexOf("android")>-1,game.ios=game.ua.indexOf("iphone")>-1||game.ua.indexOf("ipad")>-1,(e=game.ctx.createLinearGradient(0,0,0,game.HEIGHT)).addColorStop(0,"#036"),e.addColorStop(.5,"#69a"),e.addColorStop(1,"yellow"),game.gradients.dawn=e,(e=game.ctx.createLinearGradient(0,0,0,game.HEIGHT)).addColorStop(0,"#69a"),e.addColorStop(.5,"#9cd"),e.addColorStop(1,"#fff"),game.gradients.day=e,(e=game.ctx.createLinearGradient(0,0,0,game.HEIGHT)).addColorStop(0,"#036"),e.addColorStop(.3,"#69a"),e.addColorStop(1,"pink"),game.gradients.dusk=e,(e=game.ctx.createLinearGradient(0,0,0,game.HEIGHT)).addColorStop(0,"#036"),e.addColorStop(1,"black"),game.gradients.night=e,window.addEventListener("click",function(e){e.preventDefault(),game.Input.set(e)},!1),window.addEventListener("touchstart",function(e){e.preventDefault(),game.Input.set(e.touches[0])},!1),window.addEventListener("keydown",function(e){32!=e.keyCode&&38!=e.keyCode&&13!=e.keyCode||game.Input.set(e)},!1),game.resize(),game.changeState("Splash"),game.loop()},resize:function(){if(1!=gameInit)return!1;game.currentHeight=window.innerHeight,game.currentWidth=game.currentHeight*game.RATIO,document.body.style.backgroundColor="#F77E9D",game.currentWidth>window.innerWidth&&(game.currentWidth=window.innerWidth,game.currentHeight=game.currentWidth/game.RATIO,document.body.style.backgroundColor="#D2691E"),(game.android||game.ios)&&(document.body.style.height=window.innerHeight+50+"px"),game.canvas.style.width=game.currentWidth+"px",game.canvas.style.height=game.currentHeight+"px",game.scale=game.currentWidth/game.WIDTH,game.offset.top=game.canvas.offsetTop,game.offset.left=game.canvas.offsetLeft,window.setTimeout(function(){window.scrollTo(0,1)},1)},update:function(){game.game.update(),game.Input.tapped=!1},render:function(){for(game.Draw.rect(0,0,game.WIDTH,game.HEIGHT,game.gradients[game.bg_grad]),i=0;i<game.entities.length;i+=1)game.entities[i].render();game.game.render()},loop:function(){requestAnimFrame(game.loop),game.update(),game.render()},changeState:function(e){game.game=new window[e],game.game.init()}};game.Draw={clear:function(){game.ctx.clearRect(0,0,game.WIDTH,game.HEIGHT)},rect:function(e,t,a,i,n){game.ctx.fillStyle=n,game.ctx.fillRect(e,t,a,i)},circle:function(e,t,a,i){game.ctx.fillStyle=i,game.ctx.beginPath(),game.ctx.arc(e+5,t+5,a,0,2*Math.PI,!0),game.ctx.closePath(),game.ctx.fill()},Image:function(e,t,a){game.ctx.drawImage(e,t,a)},Sprite:function(e,t,a,i,n,s,o,r,g,m){game.ctx.save(),game.ctx.translate(s,o),game.ctx.rotate(m*(Math.PI/180)),game.ctx.translate(-(s+r/2),-(o+g/2)),game.ctx.drawImage(e,t,a,i,n,s,o,r,g),game.ctx.restore()},semiCircle:function(e,t,a,i){game.ctx.fillStyle=i,game.ctx.beginPath(),game.ctx.arc(e,t,a,0,Math.PI,!1),game.ctx.closePath(),game.ctx.fill()},text:function(e,t,a,i,n){game.ctx.font="bold "+i+"px Monospace",game.ctx.fillStyle=n,game.ctx.fillText(e,t,a)}},game.Input={x:0,y:0,tapped:!1,set:function(e){this.x=(e.pageX-game.offset.left)/game.scale,this.y=(e.pageY-game.offset.top)/game.scale,this.tapped=!0}},game.Cloud=function(e,t){this.x=e,this.y=t,this.r=30,this.col="rgba(255,255,255,1)",this.type="cloud",this.vx=-.1,this.remove=!1,this.update=function(){this.x+=this.vx,this.x<-115&&this.respawn()},this.render=function(){game.Draw.circle(this.x+this.r,this.y+this.r,this.r,this.col),game.Draw.circle(this.x+55,this.y+this.r/2,this.r/.88,this.col),game.Draw.circle(this.x+55,this.y+this.r+15,this.r,this.col),game.Draw.circle(this.x+85,this.y+this.r,this.r,this.col)},this.respawn=function(){this.x=~~(Math.random()*this.r*2)+game.WIDTH,this.y=~~(Math.random()*game.HEIGHT/2)}},game.BottomBar=function(e,t,a){this.x=e,this.y=t,this.r=a,this.vx=-1,this.name="BottomBar",this.update=function(){this.x+=this.vx,this.x<0-this.r&&this.respawn()},this.render=function(){game.Draw.rect(this.x,this.y,this.r,100,"#D2691E");for(var e=0;e<10;e++)game.Draw.semiCircle(this.x+e*(this.r/9),this.y,20,"#050")},this.respawn=function(){this.x=game.WIDTH-1}},game.Tree=function(e,t){this.x=e,this.y=t,this.r=30,this.h=50,this.w=2*this.r,this.vx=-1,this.type="Tree",this.update=function(){this.x+=this.vx,this.x<0-2*this.r&&this.respawn()},this.render=function(){game.Draw.circle(this.x+this.r,this.y+this.r-10,this.r,"green","#005500"),game.Draw.circle(this.x+this.r/2,this.y+this.r-10,this.r/3,"rgba(0,0,0,0.08)"),game.Draw.rect(this.x+this.r,this.y+this.r,10,this.r,"brown","#d20")},this.respawn=function(){this.x=game.WIDTH+this.r}},game.Pipe=function(e,t){this.centerX=e,this.coin=!0,this.w=t,this.h=game.HEIGHT-180,this.vx=-1,this.type="pipe",this.update=function(){this.centerX+=this.vx,this.centerX==0-this.w&&this.respawn()},this.render=function(){this.coin&&game.Draw.circle(this.centerX+this.w/2-5,this.centerY-5,5,"Gold"),game.Draw.rect(this.centerX,0,this.w,this.centerY-pipeGapSize,"#f77e9d"),game.Draw.rect(this.centerX,this.centerY+pipeGapSize,this.w,this.h-this.centerY,"#f77e9d")},this.respawn=function(){this.centerY=this.randomIntFromInterval(70,220),this.centerX=320-this.w+160,this.coin=!0},this.randomIntFromInterval=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},this.centerY=this.randomIntFromInterval(70,220)},game.Deneal=function(){this.img=new Image,this.img.src=config[1]+".png",this.gravity=config[5],this.width=34,this.height=47,this.ix=0,this.iy=0,this.fr=0,this.vy=180,this.vx=70,this.velocity=0,this.play=!1,this.jump=-4.6,this.rotation=0,this.type="deneal",this.update=function(){this.play&&(this.velocity+=this.gravity,this.vy+=this.velocity,this.rotation=Math.min(this.velocity/15*90,90)),game.Input.tapped&&(this.play=!0,play_sound(soundJump),this.velocity=this.jump)},this.render=function(){game.Draw.Sprite(this.img,this.ix,this.iy,this.width,this.height,this.vx,this.vy,this.width,this.height,this.rotation)}},game.Particle=function(e,t,a,i,n){this.x=e,this.y=t,this.r=a,this.col=i,this.type=n||"circle",this.name="particle",this.dir=2*Math.random()>1?1:-1,this.vx=~~(4*Math.random())*this.dir,this.vy=~~(7*Math.random()),this.remove=!1,this.update=function(){this.x+=this.vx,this.y-=this.vy,this.vx*=.99,this.vy*=.99,this.vy-=.35,this.y>game.HEIGHT&&(this.remove=!0)},this.render=function(){"star"===this.type?game.Draw.star(this.x,this.y,this.col):game.Draw.circle(this.x,this.y,this.r,this.col)}},game.Collides=function(e,t){if(e.vy>=370)return!0;t.coin&&e.vx>t.centerX+t.w/2-5&&(t.coin=!1,game.score.coins+=1,game.digits=game.score.coins.toString().split(""),play_sound(soundScore));var a=e.vx-e.width/2,i=e.vy-e.height/2,n=e.vx+e.width/2,s=e.vy+e.height/2,o=t.centerX,r=t.centerX+t.w,g=t.centerY-pipeGapSize,m=t.centerX,h=t.centerY+pipeGapSize,c=r,d=t.h;return!(a>r||n<o||i>g||s<0)||!(a>c||n<m||i>d||s<h)},window.Splash=function(){this.banner=new Image,this.banner.src=config[0]+".png",this.init=function(){for(play_sound(soundSwoosh),game.distance=0,game.bg_grad="day",game.entities=[],game.score.taps=game.score.coins=0,game.entities.push(new game.Cloud(30,~~(Math.random()*game.HEIGHT/2))),game.entities.push(new game.Cloud(130,~~(Math.random()*game.HEIGHT/2))),game.entities.push(new game.Cloud(230,~~(Math.random()*game.HEIGHT/2))),i=0;i<2;i+=1)game.entities.push(new game.BottomBar(game.WIDTH*i,game.HEIGHT-100,game.WIDTH));game.entities.push(new game.Tree(~~(Math.random()*game.WIDTH),game.HEIGHT-160)),game.entities.push(new game.Tree(~~(Math.random()*game.WIDTH+50),game.HEIGHT-160)),game.entities.push(new game.Tree(~~(Math.random()*game.WIDTH+100),game.HEIGHT-160))},this.update=function(){for(i=0;i<game.entities.length;i+=1)game.entities[i].update();game.Input.tapped&&gameRunning?(game.Input.tapped=!1,game.changeState("Play")):game.Input.tapped&&(game.Input.tapped=!1,gameRunning=!0)},this.render=function(){game.Draw.Image(this.banner,66,100)}},window.Play=function(){this.init=function(){game.entities.push(new game.Pipe(2*game.WIDTH,50)),game.entities.push(new game.Pipe(2*game.WIDTH+game.WIDTH/2,50)),game.entities.push(new game.Pipe(3*game.WIDTH,50)),game.deneal=new game.Deneal,game.entities.push(game.deneal);for(var e=0;e<10;e++){var t=new Image;t.src="font_small_"+e+".png",game.fonts.push(t)}game.digits=["0"]},this.update=function(){if(game.distance+=1,game.distance%2048==0){for(var e="day",t=["day","dusk","night","dawn"],a=0;a<t.length;a++)game.bg_grad===t[a]&&(e=a==t.length-1?"day":t[a+1]);game.bg_grad=e}for(game.Input.tapped&&(game.score.taps+=1,!0),game.deneal.vy<0&&game.changeState("GameOver"),game.score.coins>=config[3]&&game.changeState("GameOver"),a=0;a<game.entities.length;a+=1){if(game.entities[a].update(),"pipe"===game.entities[a].type)if(game.Collides(game.deneal,game.entities[a])){play_sound(soundHit),game.changeState("GameOver");break}}},this.render=function(){for(var e=game.WIDTH/2-14*game.digits.length/2,t=0;t<game.digits.length;t++)game.Draw.Image(game.fonts[Number(game.digits[t])],e+14*t,10)}},window.GameOver=function(){this.getHighScore=function(){var e=getCookie("highscore");if(""!=e){var t=parseInt(e)||0;return t<game.score.coins&&setCookie("highscore",t=game.score.coins,999),t}return setCookie("highscore",game.score.coins,999),game.score.coins},this.init=function(){var e=this;setTimeout(function(){play_sound(soundDie,!0),e.banner=new Image,e.banner.src=config[2]+".png",e.replay=new Image,e.replay.src="replay.png",e.highscore=e.getHighScore(),game.score.coins>=config[3]&&(won=!0,document.body.style.backgroundColor="#222329",document.getElementById("game").style.display="none",document.getElementById("container").style.display="none",document.getElementById("winContainer").style.display="block",document.getElementById("score").innerHTML=game.score.coins,document.getElementById("winText").innerHTML=config[6],document.getElementById("winImage").src=config[4])},500)},this.update=function(){if(game.Input.tapped){var e=game.Input.x,t=game.Input.y;e>=102.5&&e<=217.5&&t>=260&&t<=330&&0==won&&location.reload(),game.Input.tapped=!1}game.deneal.update()},this.render=function(){this.banner&&(game.Draw.Image(this.banner,42,70),game.Draw.Image(this.replay,102.5,260),game.Draw.text(game.score.coins,220,185,15,"black"),game.Draw.text(this.highscore,220,225,15,"black"))}};